---
displayNumber: 150
status: open
priority: 2
createdAt: 2026-02-15T17:48:16.385521+00:00
updatedAt: 2026-02-15T17:49:00.115820+00:00
---

# Auto-generate project config page from proto schema

## Context

The project config page (`components/settings/ProjectConfig.tsx`) currently hardcodes each Config field as a manually composed editor section. When new fields are added to the `Config` proto message, a developer must also write corresponding frontend code. The goal is to make the config page **schema-driven** — new proto fields auto-appear in the UI without writing additional frontend code, while preserving custom editors for complex fields.

## Approach: Hybrid Proto Form Renderer

Use `@bufbuild/protobuf` v2's runtime reflection (`ConfigSchema.fields` / `DescField`) to iterate proto fields and auto-generate form controls. Fields needing custom UI (states+colors, priorities+colors, custom fields) are declared as **field groups** that "claim" those proto fields. Unclaimed fields get auto-rendered based on their proto type.

## Files to Create

### 1. `lib/proto-form/types.ts` — Type definitions

- `FieldOverride` — per-field custom render/label/description/hidden
- `FieldGroup` — multi-field custom section (key, claimed field names, title, render fn, order)
- `FieldRenderProps` / `FieldGroupRenderProps` — props passed to custom renderers

### 2. `lib/proto-form/field-metadata.ts` — Proto introspection utilities

- `protoNameToLabel(name: string)` — converts `priority_levels` to `Priority Levels`
- `getFieldMeta(field: DescField)` — extracts label, type info, optionality from a DescField

### 3. `lib/proto-form/config-overrides.ts` — Config-specific groups & overrides

Field groups (preserve existing custom editors):

| Group          | Claimed fields                                 | Existing editor      | Order |
| -------------- | ---------------------------------------------- | -------------------- | ----- |
| Issue States   | `allowedStates`, `stateColors`, `defaultState` | `StateListEditor`    | 10    |
| Priorities     | `priorityLevels`, `priorityColors`             | `PriorityEditor`     | 20    |
| Custom Fields  | `customFields`                                 | `CustomFieldsEditor` | 30    |
| Default Values | `defaults`                                     | `DefaultsEditor`     | 40    |
| Workspace      | `workspace`                                    | `LlmSettingsEditor`  | 50    |

Field overrides (labels/descriptions for auto-rendered fields):

- `version` — label: "Project Version"
- `defaultEditor` — label: "Default Editor"

### 4. `components/proto-form/ProtoFormRenderer.tsx` — Main orchestrator

```
ProtoFormRenderer({ schema, value, onChange, fieldGroups, fieldOverrides })
```

Logic:

1. Build `claimedFields` set from all field groups + hidden overrides
2. Render field groups (sorted by `order`) — each wrapped in `<section class="settings-section"><h3>title</h3><div class="settings-card">...</div></section>`
3. Render unclaimed fields via `AutoFieldRenderer` (same section/card wrapper)

### 5. Auto field renderers (all in `components/proto-form/renderers/`)

| Renderer                   | Proto type                               | HTML output                                                                                                                                |
| -------------------------- | ---------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------ |
| `ScalarFieldRenderer`      | `fieldKind: "scalar"`                    | `STRING` → text input, `BOOL` → checkbox, `INT32/UINT32/FLOAT/DOUBLE` → number input, `INT64/UINT64` → number input with bigint conversion |
| `MapFieldRenderer`         | `fieldKind: "map"`                       | Key-value table with add/remove (same pattern as `DefaultsEditor`)                                                                         |
| `ListFieldRenderer`        | `fieldKind: "list", listKind: "scalar"`  | Tag-style add/remove list                                                                                                                  |
| `MessageFieldRenderer`     | `fieldKind: "message"`                   | Recursive `ProtoFormRenderer` for sub-message                                                                                              |
| `MessageListFieldRenderer` | `fieldKind: "list", listKind: "message"` | Add/remove list of nested sub-forms (collapsible items)                                                                                    |

### 6. `styles/components/ProtoForm.css` — Styles for auto-generated fields

Follow existing patterns: use CSS variables (`--space-*`, `--color-*`, `--radius-*`), global class names with `proto-form-` prefix.

## File to Modify

### 7. `components/settings/ProjectConfig.tsx` — Integration

Replace the manual `{config && (<> ... </>)}` section (lines 294–383) with:

```tsx
import { ConfigSchema } from '@/gen/centy_pb'
import { ProtoFormRenderer } from '@/components/proto-form/ProtoFormRenderer'
import {
  CONFIG_FIELD_GROUPS,
  CONFIG_FIELD_OVERRIDES,
} from '@/lib/proto-form/config-overrides'

{
  config && (
    <>
      <ProtoFormRenderer
        schema={ConfigSchema}
        value={config as unknown as Record<string, unknown>}
        onChange={updates => updateConfig(updates as Partial<Config>)}
        fieldGroups={CONFIG_FIELD_GROUPS}
        fieldOverrides={CONFIG_FIELD_OVERRIDES}
      />
      <div className="settings-actions">...</div>
    </>
  )
}
```

The Organization, Project Title, Agent Config, and Manifest sections remain unchanged (they use separate RPCs, not Config proto fields).

## What Auto-Generates Today

With the current Config proto, these fields will auto-render:

- `version` (string) → text input
- `default_editor` (string) → text input
- `custom_link_types` (repeated LinkTypeDefinition) → nested message list editor
- `hooks` (repeated HookDefinition) → nested message list editor

## Key Benefit

When someone adds e.g. `string project_description = 14;` to Config in `centy.proto` and re-generates, a text input labeled "Project Description" automatically appears in the settings page. No frontend changes needed.

## Verification

1. Run `npm run dev` and navigate to project config page
2. Verify all existing sections render identically (states, priorities, custom fields, defaults, workspace)
3. Verify auto-generated fields appear for `version`, `default_editor`, `custom_link_types`, `hooks`
4. Run `npm run build` to check for type errors
5. Test adding/editing values in auto-generated fields and verify save/reset work
