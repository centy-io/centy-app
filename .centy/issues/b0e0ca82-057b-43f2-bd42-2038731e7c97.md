---
displayNumber: 174
status: open
priority: 2
createdAt: 2026-02-22T01:07:43.274774+00:00
updatedAt: 2026-02-22T01:08:39.666911+00:00
---

# refactor: make URL the single source of truth for org and project

## Problem

Org and project are currently stored in multiple places, creating potential inconsistencies:

1. `OrganizationProvider` persists `selectedOrgSlug` and `hasExplicitSelection` to localStorage (`centy-selected-org`, `centy-org-explicit-selection`). This means the "selected org" can differ from what the URL says — e.g., URL is `/acme/my-project` but localStorage has `selectedOrgSlug = 'other-org'`.

2. `ProjectProvider` persists `projectPath` to localStorage (`centy-project-path`). The filesystem path of the current project is derived from the URL → daemon resolution, but this store holds a stale copy that outlives navigation.

3. `PathContextProvider.useResolve.ts` writes `LAST_PROJECT_STORAGE_KEY` to localStorage whenever a project resolves, creating yet another copy of project identity outside the URL.

The URL already contains the full org + project identity (`/[organization]/[project]/...`). Everything else should be derived from it, not stored alongside it.

## Goal

When any component needs to know the current org or project, it reads from the URL (via `useUrlParams()` / `usePathContext()`). No localStorage keys should encode "current org" or "current project" as independent state.

## Changes

### `OrganizationProvider`

- Remove `STORAGE_KEY` (`centy-selected-org`) and `EXPLICIT_SELECTION_KEY` (`centy-org-explicit-selection`) localStorage reads/writes
- Derive `selectedOrgSlug` from the current URL (`useUrlParams().urlOrg`) instead of a persisted value
- Remove `hasExplicitSelection` state — it only existed to guard the localStorage restore
- The provider still owns `organizations` list, `loading`, `error`, `refreshOrganizations`; the selected org is now always the one in the URL

### `ProjectProvider`

- Remove `STORAGE_KEY` (`centy-project-path`) localStorage read/write
- `projectPath` should come from `PathContext` (already resolved from URL → daemon), not a stale localStorage value
- Evaluate whether `ProjectProvider` is still needed after this change, or if its consumers can switch to `usePathContext()`

### `PathContextProvider.useResolve.ts`

- Remove the `localStorage.setItem(LAST_PROJECT_STORAGE_KEY, ...)` write inside `useProjectResolution`
- If "last visited project" redirect behavior is needed elsewhere, it should be handled explicitly (e.g., a dedicated redirect hook that reads `LAST_PROJECT_STORAGE_KEY` only on the root route), not written as a side-effect of project resolution

## Files to change

- `components/providers/OrganizationProvider.tsx` — remove localStorage, derive org from URL
- `components/providers/OrganizationProvider.types.ts` — remove `hasExplicitSelection` from `OrganizationContextType`
- `components/providers/ProjectProvider.tsx` — remove localStorage, reassess whether the provider is still needed
- `components/providers/PathContextProvider.useResolve.ts` — remove `LAST_PROJECT_STORAGE_KEY` write
- Any consumers of `useOrganization().hasExplicitSelection` or `useProject().projectPath` that relied on the localStorage-backed value
